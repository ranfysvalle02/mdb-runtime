version: '3.8'

# ============================================================================
# Production Docker Compose Override
# Use with: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
# ============================================================================

services:
  app:
    restart: always  # Always restart in production
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    # Production environment variables
    environment:
      - LOG_LEVEL=WARNING  # Less verbose in production
      - PYTHONUNBUFFERED=1
    # Remove resource limits in production (or set appropriately)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2.0'
    #       memory: 1G

  mongodb:
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    # Production: Use named volumes instead of bind mounts
    volumes:
      - mongodb_data_prod:/data/db
      - mongodb_config_prod:/data/configdb
    # Production: Consider replica set configuration
    # command: mongod --replSet rs0 --bind_ip_all

volumes:
  mongodb_data_prod:
    driver: local
  mongodb_config_prod:
    driver: local

