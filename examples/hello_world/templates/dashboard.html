<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Dashboard - MDB Runtime</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0D1117;
            color: #E6EDF3;
            min-height: 100vh;
        }
        
        /* MongoDB Dark Theme */
        :root {
            --mongodb-green: #00ED64;
            --mongodb-dark-green: #13AA52;
            --mongodb-dark: #001E2B;
            --mongodb-bg: #0D1117;
            --mongodb-bg-secondary: #161B22;
            --mongodb-bg-tertiary: #21262D;
            --mongodb-border: #30363D;
            --mongodb-text: #E6EDF3;
            --mongodb-text-secondary: #8B949E;
            --mongodb-light-green: #00ED64;
        }
        
        .header {
            background: var(--mongodb-bg-secondary);
            border-bottom: 2px solid var(--mongodb-green);
            color: var(--mongodb-text);
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0, 237, 100, 0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header h1::before {
            content: "üçÉ";
            font-size: 32px;
        }
        
        .header p {
            opacity: 0.95;
            font-size: 14px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-email {
            font-size: 14px;
            opacity: 0.95;
        }
        
        .btn-logout {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--mongodb-bg-secondary);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--mongodb-border);
            border-left: 4px solid var(--mongodb-green);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            border-left-color: var(--mongodb-light-green);
            box-shadow: 0 4px 20px rgba(0, 237, 100, 0.15);
            transform: translateY(-2px);
        }
        
        .stat-card h3 {
            font-size: 12px;
            color: var(--mongodb-text-secondary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: var(--mongodb-green);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--mongodb-border);
        }
        
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--mongodb-text-secondary);
            transition: all 0.3s;
        }
        
        .tab.active {
            color: var(--mongodb-green);
            border-bottom-color: var(--mongodb-green);
        }
        
        .tab:hover {
            color: var(--mongodb-green);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: var(--mongodb-bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--mongodb-border);
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            padding: 20px;
            border-bottom: 1px solid var(--mongodb-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--mongodb-bg-tertiary);
        }
        
        .card-header h2 {
            font-size: 20px;
            color: var(--mongodb-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .greeting-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .greeting-form input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid var(--mongodb-border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--mongodb-bg-tertiary);
            color: var(--mongodb-text);
        }
        
        .greeting-form input:focus {
            outline: none;
            border-color: var(--mongodb-green);
            box-shadow: 0 0 0 3px rgba(0, 237, 100, 0.1);
        }
        
        .greeting-form select {
            padding: 12px;
            border: 2px solid var(--mongodb-border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--mongodb-bg-tertiary);
            color: var(--mongodb-text);
        }
        
        .btn-primary {
            padding: 12px 24px;
            background: var(--mongodb-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: var(--mongodb-dark-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 237, 100, 0.3);
        }
        
        .btn-secondary {
            padding: 8px 16px;
            background: var(--mongodb-bg-tertiary);
            color: var(--mongodb-text);
            border: 1px solid var(--mongodb-border);
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: var(--mongodb-bg);
            border-color: var(--mongodb-green);
            color: var(--mongodb-green);
        }
        
        .btn-danger {
            padding: 6px 12px;
            background: rgba(255, 59, 48, 0.1);
            color: #FF3B30;
            border: 1px solid rgba(255, 59, 48, 0.3);
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-danger:hover {
            background: rgba(255, 59, 48, 0.2);
            border-color: #FF3B30;
        }
        
        .greetings-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .greeting-item {
            padding: 15px;
            border-bottom: 1px solid var(--mongodb-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .greeting-item:hover {
            background: var(--mongodb-bg-tertiary);
            border-left: 3px solid var(--mongodb-green);
            padding-left: 12px;
        }
        
        .greeting-item:last-child {
            border-bottom: none;
        }
        
        .greeting-content {
            flex: 1;
        }
        
        .greeting-message {
            font-size: 16px;
            color: var(--mongodb-text);
            margin-bottom: 5px;
        }
        
        .greeting-meta {
            font-size: 12px;
            color: var(--mongodb-text-secondary);
        }
        
        .greeting-actions {
            display: flex;
            gap: 10px;
        }
        
        .health-status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .health-status.healthy {
            background: rgba(0, 237, 100, 0.1);
            color: var(--mongodb-green);
            border: 1px solid rgba(0, 237, 100, 0.3);
        }
        
        .health-status.unhealthy {
            background: rgba(255, 59, 48, 0.1);
            color: #FF3B30;
            border: 1px solid rgba(255, 59, 48, 0.3);
        }
        
        .health-status.degraded {
            background: rgba(255, 149, 0, 0.1);
            color: #FF9500;
            border: 1px solid rgba(255, 149, 0, 0.3);
        }
        
        .health-status.unknown {
            background: var(--mongodb-bg-tertiary);
            color: var(--mongodb-text-secondary);
            border: 1px solid var(--mongodb-border);
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric-item {
            padding: 12px;
            background: var(--mongodb-bg-tertiary);
            border-radius: 8px;
            border-left: 3px solid var(--mongodb-green);
            border: 1px solid var(--mongodb-border);
        }
        
        .metric-item strong {
            display: block;
            font-size: 12px;
            color: var(--mongodb-text-secondary);
            margin-bottom: 5px;
        }
        
        .metric-item span {
            font-size: 18px;
            font-weight: 600;
            color: var(--mongodb-green);
        }
        
        .index-list {
            margin-top: 15px;
        }
        
        .index-item {
            padding: 15px;
            background: var(--mongodb-bg-tertiary);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid var(--mongodb-green);
            border: 1px solid var(--mongodb-border);
        }
        
        .index-name {
            font-weight: 600;
            color: var(--mongodb-green);
            margin-bottom: 8px;
        }
        
        .index-details {
            font-size: 12px;
            color: var(--mongodb-text-secondary);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .index-keys {
            font-family: 'SF Mono', 'Monaco', monospace;
            background: var(--mongodb-bg);
            padding: 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-top: 5px;
            color: var(--mongodb-green);
            border: 1px solid var(--mongodb-border);
        }
        
        .collection-card {
            background: var(--mongodb-bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 3px solid var(--mongodb-green);
            border: 1px solid var(--mongodb-border);
        }
        
        .collection-name {
            font-weight: 600;
            color: var(--mongodb-green);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .collection-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            font-size: 13px;
        }
        
        .code-example {
            background: #0D1117;
            color: #E6EDF3;
            padding: 20px;
            border-radius: 8px;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid var(--mongodb-border);
            position: relative;
            line-height: 1.6;
        }
        
        .code-example::before {
            content: 'PYTHON';
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 10px;
            color: var(--mongodb-text-secondary);
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .code-example .comment {
            color: #8B949E;
            font-style: italic;
        }
        
        .code-example .keyword {
            color: #FF7B72;
            font-weight: 600;
        }
        
        .code-example .string {
            color: #A5D6FF;
        }
        
        .code-example .function {
            color: #D2A8FF;
        }
        
        .code-example .operator {
            color: #79C0FF;
        }
        
        .code-example .number {
            color: #79C0FF;
        }
        
        .code-example .variable {
            color: #FFA657;
        }
        
        .code-example .checkmark {
            color: var(--mongodb-green);
            font-weight: bold;
        }
        
        .code-example {
            position: relative;
        }
        
        .refresh-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--mongodb-text-secondary);
            font-size: 12px;
            margin-left: 10px;
            font-weight: 500;
        }
        
        .refresh-indicator.active {
            color: var(--mongodb-green);
        }
        
        .connection-status-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }
        
        /* Connected - Pulsing green circle with checkmark */
        .connection-status-icon.connected {
            animation: pulse-green 2s ease-in-out infinite;
        }
        
        .connection-status-icon.connected svg {
            width: 100%;
            height: 100%;
        }
        
        @keyframes pulse-green {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }
        
        /* Connecting - Rotating spinner */
        .connection-status-icon.connecting {
            animation: spin 1s linear infinite;
        }
        
        .connection-status-icon.connecting svg {
            width: 100%;
            height: 100%;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Reconnecting - Pulsing orange */
        .connection-status-icon.reconnecting {
            animation: pulse-orange 1.5s ease-in-out infinite;
        }
        
        .connection-status-icon.reconnecting svg {
            width: 100%;
            height: 100%;
        }
        
        @keyframes pulse-orange {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.15);
                opacity: 0.7;
            }
        }
        
        /* Failed - Static red */
        .connection-status-icon.failed svg {
            width: 100%;
            height: 100%;
        }
        
        /* Disconnected - Static gray */
        .connection-status-icon.disconnected svg {
            width: 100%;
            height: 100%;
        }
        
        .stats-grid .stat-card {
            transition: all 0.3s;
        }
        
        /* WebSocket Demo Styles - Compact & Modern */
        .websocket-demo-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 12px;
        }
        
        .websocket-demo-top {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        @media (max-width: 1024px) {
            .websocket-demo-top {
                grid-template-columns: 1fr;
            }
        }
        
        .websocket-demo-responses {
            width: 100%;
        }
        
        .websocket-demo-card {
            background: var(--mongodb-bg-secondary);
            border: 1px solid var(--mongodb-border);
            border-radius: 10px;
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .websocket-demo-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--mongodb-green), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .websocket-demo-card:hover::before {
            opacity: 1;
        }
        
        .websocket-demo-card h4 {
            margin: 0 0 12px 0;
            color: var(--mongodb-green);
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .demo-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .demo-btn {
            background: var(--mongodb-bg-tertiary);
            border: 1px solid var(--mongodb-border);
            color: var(--mongodb-text);
            padding: 10px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .demo-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 237, 100, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }
        
        .demo-btn:hover::after {
            width: 200px;
            height: 200px;
        }
        
        .demo-btn:hover {
            border-color: var(--mongodb-green);
            background: var(--mongodb-bg-secondary);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 237, 100, 0.15);
        }
        
        .demo-btn:active {
            transform: translateY(0);
            transition: transform 0.1s;
        }
        
        .demo-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .demo-btn.loading {
            position: relative;
            color: transparent;
        }
        
        .demo-btn.loading::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 14px;
            height: 14px;
            margin: -7px 0 0 -7px;
            border: 2px solid var(--mongodb-green);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .btn-icon {
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .response-container {
            background: var(--mongodb-bg-tertiary);
            border: 1px solid var(--mongodb-border);
            border-radius: 8px;
            padding: 8px 12px;
            max-height: 200px;
            overflow-y: auto;
            min-height: 60px;
            scrollbar-width: thin;
            scrollbar-color: var(--mongodb-border) transparent;
        }
        
        .response-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .response-container::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .response-container::-webkit-scrollbar-thumb {
            background: var(--mongodb-border);
            border-radius: 3px;
        }
        
        .response-container::-webkit-scrollbar-thumb:hover {
            background: var(--mongodb-green);
        }
        
        .response-placeholder {
            color: var(--mongodb-text-secondary);
            text-align: center;
            padding: 12px;
            font-style: italic;
            font-size: 12px;
        }
        
        .response-item {
            background: var(--mongodb-bg-secondary);
            border-left: 2px solid var(--mongodb-green);
            padding: 6px 12px;
            margin-bottom: 4px;
            border-radius: 4px;
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            min-height: 32px;
        }
        
        .response-item:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0, 237, 100, 0.1);
            background: var(--mongodb-bg-tertiary);
        }
        
        .response-item.error {
            border-left-color: #F85149;
        }
        
        .response-item.info {
            border-left-color: #58A6FF;
        }
        
        .response-item.success {
            border-left-color: var(--mongodb-green);
        }
        
        .response-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }
        
        .response-item .response-type {
            font-weight: 600;
            color: var(--mongodb-green);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 80px;
        }
        
        .response-item.error .response-type {
            color: #F85149;
        }
        
        .response-item.info .response-type {
            color: #58A6FF;
        }
        
        .response-item .response-message {
            color: var(--mongodb-text);
            font-size: 12px;
            line-height: 1.3;
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .response-item .response-time {
            color: var(--mongodb-text-secondary);
            font-size: 10px;
            opacity: 0.7;
            white-space: nowrap;
            flex-shrink: 0;
            margin-left: auto;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-8px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        
        .counter-display {
            text-align: center;
            padding: 20px 16px;
            background: linear-gradient(135deg, var(--mongodb-bg-secondary) 0%, var(--mongodb-bg-tertiary) 100%);
            border: 1px solid var(--mongodb-border);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .counter-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 237, 100, 0.05) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .counter-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--mongodb-green);
            margin: 8px 0;
            text-shadow: 0 0 16px rgba(0, 237, 100, 0.3);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            z-index: 1;
            font-variant-numeric: tabular-nums;
        }
        
        .counter-value.updated {
            transform: scale(1.15) rotate(2deg);
            color: #00FF88;
            text-shadow: 0 0 24px rgba(0, 255, 136, 0.5);
        }
        
        .counter-label {
            color: var(--mongodb-text-secondary);
            font-size: 12px;
            margin-top: 6px;
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }
        
        .ws-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: var(--mongodb-bg-tertiary);
            border: 1px solid var(--mongodb-border);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin-bottom: 12px;
        }
        
        .ws-status-badge.connected {
            background: rgba(0, 237, 100, 0.1);
            border-color: var(--mongodb-green);
            color: var(--mongodb-green);
        }
        
        .ws-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--mongodb-text-secondary);
            animation: pulse-dot 2s ease-in-out infinite;
        }
        
        .ws-status-badge.connected .ws-status-dot {
            background: var(--mongodb-green);
            box-shadow: 0 0 8px rgba(0, 237, 100, 0.6);
        }
        
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }
        
        .stats-grid .stat-card.updating {
            opacity: 0.7;
        }
        
        .greeting-item.new-item {
            animation: slideIn 0.3s ease-out;
            border-left: 3px solid var(--mongodb-green);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 6px 12px;
            background: var(--mongodb-bg-tertiary);
            color: var(--mongodb-text-secondary);
            border: 1px solid var(--mongodb-border);
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 10;
        }
        
        .copy-button:hover {
            background: var(--mongodb-bg);
            border-color: var(--mongodb-green);
            color: var(--mongodb-green);
        }
        
        .copy-button.copied {
            background: rgba(0, 237, 100, 0.15);
            border-color: var(--mongodb-green);
            color: var(--mongodb-green);
        }
        
        .copy-button svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--mongodb-text-secondary);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(0, 237, 100, 0.15);
            color: var(--mongodb-green);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            border: 1px solid rgba(0, 237, 100, 0.3);
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .tabs {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <h1>MongoDB Dashboard</h1>
                <p>MDB Runtime - Multi-Tenant MongoDB Platform</p>
            </div>
            <div class="user-info">
                <span class="user-email">{{ user.email }}</span>
                <a href="/logout" class="btn-logout">Logout</a>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Documents</h3>
                <div class="value">{{ total_greetings }}</div>
            </div>
            <div class="stat-card">
                <h3>Collections</h3>
                <div class="value">{{ db_stats.get('collections', 0) if db_stats else 0 }}</div>
            </div>
            <div class="stat-card">
                <h3>Indexes</h3>
                <div class="value">{{ db_stats.get('indexes', 0) if db_stats else 0 }}</div>
            </div>
            <div class="stat-card">
                <h3>Health</h3>
                <div class="value" style="font-size: 20px; color: {% if health.status == 'healthy' %}var(--mongodb-dark-green){% elif health.status == 'unhealthy' %}#f44336{% else %}#ff9800{% endif %};">
                    {{ health.status|upper }}
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h2>üìä MongoDB Operations</h2>
            </div>
            <div class="card-body">
                <div class="tabs">
                    <button class="tab active" onclick="showTab('crud')">CRUD Operations</button>
                    <button class="tab" onclick="showTab('websocket-demo')">üîÑ WebSocket Demo</button>
                    <button class="tab" onclick="showTab('indexes')">Indexes</button>
                    <button class="tab" onclick="showTab('collections')">Collections</button>
                    <button class="tab" onclick="showTab('metrics')">Metrics</button>
                </div>
                
                <!-- CRUD Tab -->
                <div id="crud" class="tab-content active">
                    <h3 style="margin-bottom: 10px; color: var(--mongodb-green);">Create, Read, Update, Delete</h3>
                    <p style="margin-bottom: 25px; color: var(--mongodb-text-secondary); font-size: 14px; line-height: 1.6;">
                        Demonstrate MongoDB CRUD operations with automatic multi-tenant scoping. All operations are automatically filtered by <code style="background: var(--mongodb-bg-tertiary); padding: 2px 6px; border-radius: 4px; color: var(--mongodb-green);">app_id</code>.
                    </p>
                    
                    <form class="greeting-form" id="greetingForm" method="post" action="/api/greetings">
                        <input type="text" name="message" placeholder="Enter a greeting message..." required>
                        <select name="language">
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="ja">Japanese</option>
                            <option value="zh">Chinese</option>
                        </select>
                        <button type="submit" class="btn-primary">Create (INSERT)</button>
                    </form>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="code-example" style="margin: 0;" data-code="await db.greetings.insert_one({
    &quot;message&quot;: &quot;Hello, MongoDB!&quot;,
    &quot;language&quot;: &quot;en&quot;,
    &quot;created_at&quot;: datetime.utcnow()
})
# ‚úÖ Automatically scoped with app_id">
                            <button class="copy-button" onclick="copyCode(this)" title="Copy code">
                                <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                                <span>Copy</span>
                            </button>
                            <div style="margin-bottom: 10px; color: var(--mongodb-green); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">CREATE</div>
                            <div><span class="keyword">await</span> db.<span class="variable">greetings</span>.<span class="function">insert_one</span>({</div>
                            <div style="margin-left: 20px;"><span class="string">"message"</span>: <span class="string">"Hello, MongoDB!"</span>,</div>
                            <div style="margin-left: 20px;"><span class="string">"language"</span>: <span class="string">"en"</span>,</div>
                            <div style="margin-left: 20px;"><span class="string">"created_at"</span>: <span class="function">datetime</span>.<span class="function">utcnow</span>()</div>
                            <div>});</div>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--mongodb-border);">
                                <span class="checkmark">‚úÖ</span> <span class="comment">Automatically scoped with app_id</span>
                            </div>
                        </div>
                        
                        <div class="code-example" style="margin: 0;" data-code="greetings = await db.greetings.find({})
    .sort({ &quot;created_at&quot;: -1 })
    .to_list(length=100)
# ‚úÖ Only returns documents for this app">
                            <button class="copy-button" onclick="copyCode(this)" title="Copy code">
                                <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                                <span>Copy</span>
                            </button>
                            <div style="margin-bottom: 10px; color: var(--mongodb-green); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">READ</div>
                            <div><span class="keyword">const</span> <span class="variable">greetings</span> = <span class="keyword">await</span> db.<span class="variable">greetings</span>.<span class="function">find</span>({})</div>
                            <div style="margin-left: 20px;">.<span class="function">sort</span>({ <span class="string">"created_at"</span>: -<span class="number">1</span> })</div>
                            <div style="margin-left: 20px;">.<span class="function">to_list</span>(<span class="variable">length</span>=<span class="number">100</span>);</div>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--mongodb-border);">
                                <span class="checkmark">‚úÖ</span> <span class="comment">Only returns documents for this app</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="code-example" style="margin: 0;" data-code="await db.greetings.update_one(
    { &quot;_id&quot;: ObjectId(id) },
    { $set: { &quot;message&quot;: &quot;Updated!&quot; } }
)
# ‚úÖ Automatically filters by app_id">
                            <button class="copy-button" onclick="copyCode(this)" title="Copy code">
                                <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                                <span>Copy</span>
                            </button>
                            <div style="margin-bottom: 10px; color: var(--mongodb-green); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">UPDATE</div>
                            <div><span class="keyword">await</span> db.<span class="variable">greetings</span>.<span class="function">update_one</span>(</div>
                            <div style="margin-left: 20px;">{ <span class="string">"_id"</span>: <span class="function">ObjectId</span>(<span class="variable">id</span>) },</div>
                            <div style="margin-left: 20px;">{ $set: { <span class="string">"message"</span>: <span class="string">"Updated!"</span> } }</div>
                            <div>);</div>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--mongodb-border);">
                                <span class="checkmark">‚úÖ</span> <span class="comment">Automatically filters by app_id</span>
                            </div>
                        </div>
                        
                        <div class="code-example" style="margin: 0;" data-code="await db.greetings.delete_one(
    { &quot;_id&quot;: ObjectId(id) }
)
# ‚úÖ Only deletes from this app's scope">
                            <button class="copy-button" onclick="copyCode(this)" title="Copy code">
                                <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                                <span>Copy</span>
                            </button>
                            <div style="margin-bottom: 10px; color: var(--mongodb-green); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">DELETE</div>
                            <div><span class="keyword">await</span> db.<span class="variable">greetings</span>.<span class="function">delete_one</span>(</div>
                            <div style="margin-left: 20px;">{ <span class="string">"_id"</span>: <span class="function">ObjectId</span>(<span class="variable">id</span>) }</div>
                            <div>);</div>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--mongodb-border);">
                                <span class="checkmark">‚úÖ</span> <span class="comment">Only deletes from this app's scope</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="greetings-list">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: var(--mongodb-text-secondary);">Current Documents:</h4>
                            <div class="refresh-indicator" id="greetingsRefreshIndicator">
                                <div class="connection-status-icon disconnected" id="greetingsStatusIcon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/>
                                    </svg>
                                </div>
                                <span>Disconnected</span>
                            </div>
                        </div>
                        {% if greetings %}
                            {% for greeting in greetings %}
                            <div class="greeting-item" id="greeting-{{ greeting._id }}">
                                <div class="greeting-content">
                                    <div class="greeting-message">{{ greeting.message }}</div>
                                    <div class="greeting-meta">
                                        <span class="badge">{{ greeting.language }}</span>
                                        <span style="margin-left: 10px;">
                                            Created: {{ greeting.created_at.strftime('%Y-%m-%d %H:%M') if greeting.created_at else 'N/A' }}
                                        </span>
                                        {% if greeting.get('updated_at') %}
                                        <span style="margin-left: 10px;">
                                            Updated: {{ greeting.updated_at.strftime('%Y-%m-%d %H:%M') }}
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="greeting-actions">
                                    <button class="btn-secondary" onclick="editGreeting('{{ greeting._id }}', '{{ greeting.message|replace("'", "\\'") }}', '{{ greeting.language }}')">Update</button>
                                    <button class="btn-danger" onclick="deleteGreeting('{{ greeting._id }}')">Delete</button>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <p>No documents yet. Create one above! üëÜ</p>
                            </div>
                        {% endif %}
                    </div>
                    
                </div>
                
                <!-- WebSocket Demo Tab -->
                <div id="websocket-demo" class="tab-content">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
                        <div>
                            <h3 style="margin: 0 0 4px 0; color: var(--mongodb-green); font-size: 18px;">üîÑ Real-Time Communication</h3>
                            <p style="margin: 0; color: var(--mongodb-text-secondary); font-size: 12px; line-height: 1.4;">
                                Bi-directional WebSocket demo ‚Ä¢ Open multiple tabs to see broadcasts
                            </p>
                        </div>
                        <div class="ws-status-badge" id="ws-status-badge">
                            <span class="ws-status-dot"></span>
                            <span id="ws-status-text">Connecting...</span>
                        </div>
                    </div>
                    
                    <div class="websocket-demo-container">
                        <!-- Top Row: Actions & Counter -->
                        <div class="websocket-demo-top">
                            <div class="websocket-demo-card">
                                <h4>üì§ Actions</h4>
                                <div class="demo-buttons">
                                    <button class="demo-btn" onclick="sendEchoTest()" id="btn-echo">
                                        <span class="btn-icon">üì¢</span>
                                        <span>Echo</span>
                                    </button>
                                    <button class="demo-btn" onclick="requestServerTime()" id="btn-time">
                                        <span class="btn-icon">‚è∞</span>
                                        <span>Time</span>
                                    </button>
                                    <button class="demo-btn" onclick="incrementCounter()" id="btn-increment">
                                        <span class="btn-icon">‚ûï</span>
                                        <span>Increment</span>
                                    </button>
                                    <button class="demo-btn" onclick="resetCounter()" id="btn-reset">
                                        <span class="btn-icon">üîÑ</span>
                                        <span>Reset</span>
                                    </button>
                                    <button class="demo-btn" onclick="requestGreetingsCount()" id="btn-count">
                                        <span class="btn-icon">üìä</span>
                                        <span>Count</span>
                                    </button>
                                    <button class="demo-btn" onclick="sendCustomPing()" id="btn-ping">
                                        <span class="btn-icon">üèì</span>
                                        <span>Ping</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Right Column: Live Counter -->
                            <div class="websocket-demo-card">
                                <h4>üìà Live Counter</h4>
                                <div class="counter-display">
                                    <div class="counter-value" id="live-counter">0</div>
                                    <p class="counter-label">Global counter ‚Ä¢ Real-time updates</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Full Width: Responses -->
                        <div class="websocket-demo-card websocket-demo-responses">
                            <h4>üì• Server Responses</h4>
                            <div id="websocket-responses" class="response-container">
                                <div class="response-placeholder">
                                    Server responses will appear here...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Indexes Tab -->
                <div id="indexes" class="tab-content">
                    <h3 style="margin-bottom: 10px; color: var(--mongodb-green);">Database Indexes</h3>
                    <p style="margin-bottom: 25px; color: var(--mongodb-text-secondary); font-size: 14px; line-height: 1.6;">
                        Indexes improve query performance. MDB Runtime automatically creates indexes defined in your manifest.
                    </p>
                    
                    {% if indexes_info %}
                        {% for coll_name, indexes in indexes_info.items() %}
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: var(--mongodb-green); margin-bottom: 10px;">Collection: <code style="background: var(--mongodb-bg-tertiary); padding: 2px 6px; border-radius: 4px; color: var(--mongodb-green);">{{ coll_name }}</code></h4>
                            <div class="index-list">
                                {% for index in indexes %}
                                <div class="index-item">
                                    <div class="index-name">üìë {{ index.get('name', 'Unknown') }}</div>
                                    <div class="index-details">
                                        <div><strong>Keys:</strong> 
                                            <div class="index-keys">
                                                {% if index.get('keys') %}
                                                    {% for key, direction in index.get('keys') %}
                                                    {{ key }}: {{ direction }}{% if not loop.last %}, {% endif %}
                                                    {% endfor %}
                                                {% else %}
                                                    N/A
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div><strong>Unique:</strong> {{ 'Yes' if index.get('unique') else 'No' }}</div>
                                        <div><strong>Sparse:</strong> {{ 'Yes' if index.get('sparse') else 'No' }}</div>
                                        <div><strong>Background:</strong> {{ 'Yes' if index.get('background') else 'No' }}</div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <p>No indexes found</p>
                        </div>
                    {% endif %}
                    
                    <div class="code-example" style="margin-top: 20px;" data-code='{
  &quot;managed_indexes&quot;: {
    &quot;greetings&quot;: [
      {
        &quot;type&quot;: &quot;regular&quot;,
        &quot;keys&quot;: { &quot;language&quot;: 1, &quot;created_at&quot;: -1 },
        &quot;name&quot;: &quot;language_created_idx&quot;
      }
    ]
  }
}
# ‚úÖ Automatically created on app registration'>
                        <button class="copy-button" onclick="copyCode(this)" title="Copy code">
                            <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            <span>Copy</span>
                        </button>
                        <div style="margin-bottom: 10px; color: var(--mongodb-green); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Index Definition (manifest.json)</div>
                        <div>{</div>
                        <div style="margin-left: 20px;"><span class="string">"managed_indexes"</span>: {</div>
                        <div style="margin-left: 40px;"><span class="string">"greetings"</span>: [</div>
                        <div style="margin-left: 60px;">{</div>
                        <div style="margin-left: 80px;"><span class="string">"type"</span>: <span class="string">"regular"</span>,</div>
                        <div style="margin-left: 80px;"><span class="string">"keys"</span>: { <span class="string">"language"</span>: <span class="number">1</span>, <span class="string">"created_at"</span>: -<span class="number">1</span> },</div>
                        <div style="margin-left: 80px;"><span class="string">"name"</span>: <span class="string">"language_created_idx"</span></div>
                        <div style="margin-left: 60px;">}</div>
                        <div style="margin-left: 40px;">]</div>
                        <div style="margin-left: 20px;">}</div>
                        <div>}</div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--mongodb-border);">
                            <span class="checkmark">‚úÖ</span> <span class="comment">Automatically created on app registration</span>
                        </div>
                    </div>
                </div>
                
                <!-- Collections Tab -->
                <div id="collections" class="tab-content">
                    <h3 style="margin-bottom: 10px; color: var(--mongodb-green);">Collections</h3>
                    <p style="margin-bottom: 25px; color: var(--mongodb-text-secondary); font-size: 14px; line-height: 1.6;">
                        Collections are automatically scoped with <code style="background: var(--mongodb-bg-tertiary); padding: 2px 6px; border-radius: 4px; color: var(--mongodb-green);">app_id</code> for multi-tenant isolation.
                    </p>
                    
                    {% if collections_info %}
                        {% for coll_name, stats in collections_info.items() %}
                        <div class="collection-card">
                            <div class="collection-name">üìÅ {{ coll_name }}</div>
                            <div class="collection-stats">
                                <div><strong>Documents:</strong> {{ stats.count }}</div>
                                <div><strong>Indexes:</strong> {{ stats.indexes }}</div>
                                <div><strong>Size:</strong> {{ stats.size }} KB</div>
                                <div><strong>Storage:</strong> {{ stats.storage_size }} KB</div>
                                <div><strong>Index Size:</strong> {{ stats.index_size }} KB</div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <p>No collections found</p>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Metrics Tab -->
                <div id="metrics" class="tab-content">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                        <h3 style="color: var(--mongodb-green); margin: 0;">MongoDB Metrics</h3>
                        <div class="refresh-indicator" id="metricsRefreshIndicator">
                            <div class="connection-status-icon disconnected" id="metricsStatusIcon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/>
                                </svg>
                            </div>
                            <span>Disconnected</span>
                        </div>
                    </div>
                    
                    <div class="health-status {{ health.status }}">
                        <strong>System Status:</strong> {{ health.status|upper }}
                        {% if health_details %}
                        <div style="margin-top: 10px; font-size: 14px;">
                            <div>Initialized: {{ 'Yes' if health_details.initialized else 'No' }}</div>
                            <div>Apps Registered: {{ health_details.app_count or 0 }}</div>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if pool_metrics and pool_metrics.get('status') == 'connected' %}
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--mongodb-green);">Connection Pool</h4>
                        <div class="metric-grid">
                            {% if pool_metrics.get('max_pool_size') %}
                            <div class="metric-item">
                                <strong>Max Pool Size</strong>
                                <span>{{ pool_metrics.max_pool_size }}</span>
                            </div>
                            {% endif %}
                            {% if pool_metrics.get('current_connections') is not none %}
                            <div class="metric-item">
                                <strong>Current Connections</strong>
                                <span>{{ pool_metrics.current_connections }}</span>
                            </div>
                            {% endif %}
                            {% if pool_metrics.get('available_connections') is not none %}
                            <div class="metric-item">
                                <strong>Available</strong>
                                <span>{{ pool_metrics.available_connections }}</span>
                            </div>
                            {% endif %}
                            {% if pool_metrics.get('pool_usage_percent') is not none %}
                            <div class="metric-item">
                                <strong>Pool Usage</strong>
                                <span style="color: {% if pool_metrics.pool_usage_percent > 80 %}#f44336{% elif pool_metrics.pool_usage_percent > 60 %}#ff9800{% else %}var(--mongodb-dark-green){% endif %};">
                                    {{ pool_metrics.pool_usage_percent }}%
                                </span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if db_stats %}
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--mongodb-green);">Database Statistics</h4>
                        <div class="metric-grid">
                            {% if db_stats.get('collections') is not none %}
                            <div class="metric-item">
                                <strong>Collections</strong>
                                <span>{{ db_stats.collections }}</span>
                            </div>
                            {% endif %}
                            {% if db_stats.get('objects') is not none %}
                            <div class="metric-item">
                                <strong>Documents</strong>
                                <span>{{ db_stats.objects }}</span>
                            </div>
                            {% endif %}
                            {% if db_stats.get('indexes') is not none %}
                            <div class="metric-item">
                                <strong>Indexes</strong>
                                <span>{{ db_stats.indexes }}</span>
                            </div>
                            {% endif %}
                            {% if db_stats.get('data_size_mb') is not none %}
                            <div class="metric-item">
                                <strong>Data Size</strong>
                                <span>{{ db_stats.data_size_mb }} MB</span>
                            </div>
                            {% endif %}
                            {% if db_stats.get('storage_size_mb') is not none %}
                            <div class="metric-item">
                                <strong>Storage Size</strong>
                                <span>{{ db_stats.storage_size_mb }} MB</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if server_info %}
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--mongodb-green);">MongoDB Server</h4>
                        <div class="metric-grid">
                            {% if server_info.get('version') %}
                            <div class="metric-item">
                                <strong>Version</strong>
                                <span style="font-size: 14px;">{{ server_info.version }}</span>
                            </div>
                            {% endif %}
                            {% if server_info.get('uptime_hours') is not none %}
                            <div class="metric-item">
                                <strong>Uptime</strong>
                                <span>{{ server_info.uptime_hours }} hours</span>
                            </div>
                            {% endif %}
                            {% if server_info.get('connections') %}
                            <div class="metric-item">
                                <strong>Connections</strong>
                                <span>{{ server_info.connections.current }}/{{ server_info.connections.available }}</span>
                            </div>
                            {% endif %}
                            {% if server_info.get('opcounters') %}
                            <div class="metric-item">
                                <strong>Inserts</strong>
                                <span>{{ server_info.opcounters.get('insert', 0) }}</span>
                            </div>
                            <div class="metric-item">
                                <strong>Queries</strong>
                                <span>{{ server_info.opcounters.get('query', 0) }}</span>
                            </div>
                            <div class="metric-item">
                                <strong>Updates</strong>
                                <span>{{ server_info.opcounters.get('update', 0) }}</span>
                            </div>
                            <div class="metric-item">
                                <strong>Deletes</strong>
                                <span>{{ server_info.opcounters.get('delete', 0) }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Modal -->
    <div id="editModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: var(--mongodb-bg-secondary); border: 1px solid var(--mongodb-border); padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 8px 32px rgba(0, 237, 100, 0.2);">
            <h3 style="margin-bottom: 20px; color: var(--mongodb-green);">Update Greeting</h3>
            <form id="updateForm">
                <input type="hidden" id="editId" name="id">
                <input type="text" id="editMessage" name="message" placeholder="Message" required style="width: 100%; padding: 12px; margin-bottom: 10px; border: 2px solid var(--mongodb-border); border-radius: 8px; background: var(--mongodb-bg-tertiary); color: var(--mongodb-text);">
                <select id="editLanguage" name="language" style="width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid var(--mongodb-border); border-radius: 8px; background: var(--mongodb-bg-tertiary); color: var(--mongodb-text);">
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="it">Italian</option>
                    <option value="pt">Portuguese</option>
                    <option value="ja">Japanese</option>
                    <option value="zh">Chinese</option>
                </select>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn-primary" style="flex: 1;">Update</button>
                    <button type="button" class="btn-secondary" onclick="closeEditModal()" style="flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Handle form submission with real-time update
        document.getElementById('greetingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            
            // Disable button and show loading
            submitButton.disabled = true;
            submitButton.textContent = 'Creating...';
            
            try {
                const response = await fetch('/api/greetings', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const data = await response.json();
                    // Clear form
                    e.target.reset();
                    // WebSocket will handle the update automatically
                    // Show success feedback
                    submitButton.textContent = '‚úì Created!';
                    submitButton.style.background = 'var(--mongodb-green)';
                    setTimeout(() => {
                        submitButton.textContent = originalText;
                        submitButton.style.background = '';
                        submitButton.disabled = false;
                    }, 2000);
                } else {
                    alert('Failed to create greeting');
                    submitButton.disabled = false;
                    submitButton.textContent = originalText;
                }
            } catch (error) {
                alert('Error: ' + error.message);
                submitButton.disabled = false;
                submitButton.textContent = originalText;
            }
        });
        
        // Handle update form
        document.getElementById('updateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const id = formData.get('id');
            const message = formData.get('message');
            const language = formData.get('language');
            
            const updateData = new FormData();
            updateData.append('message', message);
            updateData.append('language', language);
            
            try {
                const response = await fetch(`/api/greetings/${id}`, {
                    method: 'PUT',
                    body: updateData
                });
                
                if (response.ok) {
                    closeEditModal();
                    // WebSocket will handle the update automatically
                } else {
                    alert('Failed to update greeting');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });
        
        function editGreeting(id, message, language) {
            document.getElementById('editId').value = id;
            document.getElementById('editMessage').value = message;
            document.getElementById('editLanguage').value = language;
            document.getElementById('editModal').style.display = 'flex';
        }
        
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }
        
        async function deleteGreeting(id) {
            if (!confirm('Are you sure you want to delete this greeting?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/greetings/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    // WebSocket will handle the update automatically
                } else {
                    alert('Failed to delete greeting');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function copyCode(button) {
            const codeBlock = button.closest('.code-example');
            const code = codeBlock.getAttribute('data-code');
            
            if (!code) {
                console.error('No code found to copy');
                return;
            }
            
            // Convert HTML entities back to normal characters
            const text = code
                .replace(/&quot;/g, '"')
                .replace(/&#39;/g, "'")
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&amp;/g, '&');
            
            try {
                await navigator.clipboard.writeText(text);
                
                // Visual feedback
                const originalText = button.querySelector('span').textContent;
                button.classList.add('copied');
                button.querySelector('span').textContent = 'Copied!';
                
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.querySelector('span').textContent = originalText;
                }, 2000);
            } catch (err) {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    const originalText = button.querySelector('span').textContent;
                    button.classList.add('copied');
                    button.querySelector('span').textContent = 'Copied!';
                    setTimeout(() => {
                        button.classList.remove('copied');
                        button.querySelector('span').textContent = originalText;
                    }, 2000);
                } catch (fallbackErr) {
                    alert('Failed to copy code. Please select and copy manually.');
                }
                document.body.removeChild(textarea);
            }
        }
        
        // WebSocket real-time updates
        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 10;
        let reconnectTimeout = null;
        
        // WebSocket connection and message handling
        function connectWebSocket() {
            // Clear any existing timeout
            if (reconnectTimeout) {
                clearTimeout(reconnectTimeout);
                reconnectTimeout = null;
            }
            
            // Close existing connection if any
            if (ws && ws.readyState !== WebSocket.CLOSED) {
                ws.close();
            }
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            
            // Get authentication token from cookies
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
                return null;
            }
            
            // Try to get token from ws_token cookie (non-httponly, set for WebSocket)
            // Fallback to regular token cookie if ws_token not available
            let token = getCookie('ws_token') || getCookie('token');
            let wsUrl = `${protocol}//${window.location.host}/ws`;
            
            // Debug: Log all cookies
            console.log('üç™ All cookies:', document.cookie);
            console.log('üîë Token from ws_token cookie:', getCookie('ws_token') ? 'FOUND' : 'NOT FOUND');
            console.log('üîë Token from token cookie:', getCookie('token') ? 'FOUND' : 'NOT FOUND');
            
            // Add token as query parameter if available
            if (token) {
                wsUrl += `?token=${encodeURIComponent(token)}`;
                console.log('üîë Using authentication token for WebSocket connection (token length:', token.length, ')');
            } else {
                console.error('‚ùå No authentication token found - WebSocket will fail!');
                console.error('   Available cookies:', document.cookie || 'NONE');
            }
            
            console.log(`üîå Attempting to connect to ${wsUrl}...`);
            
            try {
                ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    console.log('‚úÖ WebSocket connected successfully. ReadyState:', ws.readyState);
                    reconnectAttempts = 0;
                    
                    // Clear any pending reconnect timeout
                    if (reconnectTimeout) {
                        clearTimeout(reconnectTimeout);
                        reconnectTimeout = null;
                    }
                    
                    // Update status IMMEDIATELY - connection is open
                    updateConnectionStatus(true);
                };
                
                ws.onmessage = (event) => {
                    try {
                        const message = JSON.parse(event.data);
                        console.log('üì® WebSocket message received:', message.type);
                        
                        // If we receive ANY message, connection is definitely working
                        // FORCE status to connected
                        if (ws && ws.readyState === WebSocket.OPEN) {
                            updateConnectionStatus(true);
                        }
                        
                        handleWebSocketMessage(message);
                    } catch (err) {
                        console.error('Error parsing WebSocket message:', err, event.data);
                    }
                };
                
                ws.onerror = (error) => {
                    console.error('‚ùå WebSocket error:', error);
                    console.error('   Error details:', {
                        readyState: ws?.readyState,
                        url: wsUrl,
                        hasToken: !!token
                    });
                    updateConnectionStatus(false);
                };
                
                ws.onclose = (event) => {
                    console.log('üîå WebSocket closed:', {
                        code: event.code,
                        reason: event.reason,
                        wasClean: event.wasClean,
                        url: wsUrl
                    });
                    if (event.code === 1008) {
                        console.error('‚ùå WebSocket closed with code 1008 (Policy Violation) - Authentication failed!');
                        console.error('   This usually means the token was missing or invalid.');
                        console.error('   Token was:', token ? `present (length: ${token.length})` : 'MISSING');
                    }
                    updateConnectionStatus(false);
                };
                
                ws.onclose = (event) => {
                    console.log(`üîå WebSocket disconnected (code: ${event.code}, reason: ${event.reason || 'none'}, wasClean: ${event.wasClean})`);
                    updateConnectionStatus(false);
                    
                    // Only reconnect if it wasn't a normal closure (1000) or going away (1001)
                    // 1000 = Normal Closure
                    // 1001 = Going Away (page navigation, etc.)
                    // 1006 = Abnormal Closure (connection lost)
                    if (event.code !== 1000 && event.code !== 1001) {
                        attemptReconnect();
                    } else {
                        console.log('WebSocket closed normally, not reconnecting');
                    }
                };
            } catch (err) {
                console.error('‚ùå Error creating WebSocket:', err);
                updateConnectionStatus(false);
                attemptReconnect();
            }
        }
        
        function attemptReconnect() {
            if (reconnectAttempts >= maxReconnectAttempts) {
                console.error('Max reconnection attempts reached');
                updateConnectionStatus(false);
                updateConnectionStatus(false);
                return;
            }
            
            reconnectAttempts++;
            const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000); // Exponential backoff, max 30s
            
            console.log(`‚è≥ Will attempt reconnect in ${delay/1000}s (${reconnectAttempts}/${maxReconnectAttempts})...`);
            
            reconnectTimeout = setTimeout(() => {
                console.log(`üîÑ Attempting to reconnect (${reconnectAttempts}/${maxReconnectAttempts})...`);
                connectWebSocket();
            }, delay);
        }
        
        function updateConnectionStatus(connected) {
            const indicators = document.querySelectorAll('.refresh-indicator');
            
            // Check actual WebSocket state
            const actualState = ws ? ws.readyState : null;
            const isActuallyOpen = actualState === WebSocket.OPEN;
            
            // If explicitly told we're connected AND WebSocket is open, show connected
            // OR if WebSocket is open regardless of what we're told, show connected
            const shouldShowConnected = (connected && isActuallyOpen) || isActuallyOpen;
            
            // Update WebSocket status badge
            updateWebSocketStatus(shouldShowConnected);
            
            indicators.forEach(indicator => {
                const icon = indicator.querySelector('.connection-status-icon');
                const span = indicator.querySelector('span');
                
                // Remove all status classes
                if (icon) {
                    icon.className = 'connection-status-icon';
                }
                
                if (shouldShowConnected) {
                    indicator.classList.add('active');
                    if (icon) {
                        icon.classList.add('connected');
                        icon.innerHTML = `
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="#00ED64" stroke-width="2" fill="none" opacity="0.2"/>
                                <circle cx="12" cy="12" r="6" fill="#00ED64" opacity="0.3">
                                    <animate attributeName="r" values="6;8;6" dur="2s" repeatCount="indefinite"/>
                                    <animate attributeName="opacity" values="0.3;0.1;0.3" dur="2s" repeatCount="indefinite"/>
                                </circle>
                                <path d="M9 12l2 2 4-4" stroke="#00ED64" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                            </svg>
                        `;
                    }
                    if (span) {
                        span.textContent = 'Connected';
                    }
                } else {
                    indicator.classList.remove('active');
                    if (!ws) {
                        if (icon) {
                            icon.classList.add('disconnected');
                            icon.innerHTML = `
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/>
                                </svg>
                            `;
                        }
                        if (span) {
                            span.textContent = 'Not initialized';
                        }
                    } else if (ws.readyState === WebSocket.CONNECTING) {
                        if (icon) {
                            icon.classList.add('connecting');
                            icon.innerHTML = `
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="var(--mongodb-green)" stroke-width="2" fill="none" opacity="0.2" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                                        <animate attributeName="stroke-dasharray" values="0 31.416;15.708 15.708;0 31.416;0 31.416" dur="1.5s" repeatCount="indefinite"/>
                                        <animate attributeName="stroke-dashoffset" values="0;-15.708;-31.416;-31.416" dur="1.5s" repeatCount="indefinite"/>
                                    </circle>
                                </svg>
                            `;
                        }
                        if (span) {
                            span.textContent = 'Connecting...';
                        }
                    } else if (reconnectAttempts > 0 && reconnectAttempts < maxReconnectAttempts) {
                        if (icon) {
                            icon.classList.add('reconnecting');
                            icon.innerHTML = `
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="#FFA657" stroke-width="2" fill="none" opacity="0.2"/>
                                    <circle cx="12" cy="12" r="6" fill="#FFA657" opacity="0.4">
                                        <animate attributeName="r" values="6;7.5;6" dur="1.5s" repeatCount="indefinite"/>
                                        <animate attributeName="opacity" values="0.4;0.2;0.4" dur="1.5s" repeatCount="indefinite"/>
                                    </circle>
                                    <path d="M12 8v4l3 2" stroke="#FFA657" stroke-width="2" stroke-linecap="round" fill="none"/>
                                </svg>
                            `;
                        }
                        if (span) {
                            span.textContent = `Reconnecting... (${reconnectAttempts}/${maxReconnectAttempts})`;
                        }
                    } else if (reconnectAttempts >= maxReconnectAttempts) {
                        if (icon) {
                            icon.classList.add('failed');
                            icon.innerHTML = `
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="#F85149" stroke-width="2" fill="none" opacity="0.2"/>
                                    <path d="M15 9l-6 6M9 9l6 6" stroke="#F85149" stroke-width="2.5" stroke-linecap="round"/>
                                </svg>
                            `;
                        }
                        if (span) {
                            span.textContent = 'Connection failed';
                        }
                    } else {
                        if (icon) {
                            icon.classList.add('disconnected');
                            icon.innerHTML = `
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/>
                                </svg>
                            `;
                        }
                        if (span) {
                            span.textContent = 'Disconnected';
                        }
                    }
                }
            });
        }
        
        function handleWebSocketMessage(message) {
            switch (message.type) {
                case 'connected':
                    console.log('‚úÖ WebSocket:', message.message);
                    updateConnectionStatus(true);
                    break;
                    
                case 'ping':
                    // Respond to ping with pong (optional, but good practice)
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({ type: 'pong' }));
                    }
                    break;
                    
                case 'greeting_created':
                    addGreetingToList(message.data);
                    // Update Documents count - increment by 1
                    const docsCard = Array.from(document.querySelectorAll('.stat-card')).find(card => {
                        const h3 = card.querySelector('h3');
                        return h3 && h3.textContent.trim() === 'Documents';
                    });
                    if (docsCard) {
                        const valueDiv = docsCard.querySelector('.value');
                        if (valueDiv) {
                            const currentValue = parseInt(valueDiv.textContent) || 0;
                            updateStatCard('Documents', currentValue + 1);
                        }
                    }
                    break;
                    
                case 'greeting_updated':
                    updateGreetingInList(message.data);
                    break;
                    
                case 'greeting_deleted':
                    removeGreetingFromList(message.data._id);
                    // Update Documents count - decrement by 1
                    const docsCard2 = Array.from(document.querySelectorAll('.stat-card')).find(card => {
                        const h3 = card.querySelector('h3');
                        return h3 && h3.textContent.trim() === 'Documents';
                    });
                    if (docsCard2) {
                        const valueDiv = docsCard2.querySelector('.value');
                        if (valueDiv) {
                            const currentValue = parseInt(valueDiv.textContent) || 0;
                            updateStatCard('Documents', Math.max(0, currentValue - 1));
                        }
                    }
                    break;
                    
                case 'metrics_update':
                    updateMetricsFromWebSocket(message.data);
                    break;
                    
                case 'metrics_updated':
                    if (message.data.total_greetings !== undefined) {
                        updateStatCard('Documents', message.data.total_greetings);
                    }
                    break;
                
                // Bi-directional WebSocket demo responses
                case 'echo_response':
                    addResponse('success', 'Echo Response', message.server_message || message.original_message, message.timestamp);
                    break;
                
                case 'server_time_response':
                    addResponse('success', 'Server Time', `Server time: ${new Date(message.server_time).toLocaleString()}`, message.timestamp);
                    break;
                
                case 'counter_updated':
                    updateLiveCounter(message.counter);
                    addResponse('success', 'Counter Updated', `Counter incremented to ${message.counter} by ${message.incremented_by}`, message.timestamp);
                    break;
                
                case 'counter_reset':
                    updateLiveCounter(0);
                    addResponse('success', 'Counter Reset', `Counter reset to 0 by ${message.reset_by}`, message.timestamp);
                    break;
                
                case 'greetings_count_response':
                    addResponse('success', 'Greetings Count', `Total greetings in database: ${message.count}`, message.timestamp);
                    break;
                
                case 'pong_response':
                    addResponse('success', 'Pong Response', message.message, message.timestamp);
                    break;
                
                case 'error':
                    addResponse('error', 'Error', message.message || 'An error occurred', message.timestamp);
                    break;
                    
                case 'metrics_update':
                    // Full metrics update from periodic broadcast
                    updateMetricsFromWebSocket(message.data);
                    if (message.data.db_stats && message.data.db_stats.objects !== undefined) {
                        updateStatCard('Documents', message.data.db_stats.objects);
                    }
                    if (message.data.db_stats && message.data.db_stats.collections !== undefined) {
                        updateStatCard('Collections', message.data.db_stats.collections);
                    }
                    if (message.data.db_stats && message.data.db_stats.indexes !== undefined) {
                        updateStatCard('Indexes', message.data.db_stats.indexes);
                    }
                    break;
            }
        }
        
        function addGreetingToList(greeting) {
            const list = document.querySelector('.greetings-list');
            if (!list) return;
            
            // Check if item already exists
            if (document.getElementById(`greeting-${greeting._id}`)) {
                return; // Already exists, skip
            }
            
            const item = document.createElement('div');
            item.className = 'greeting-item new-item';
            item.id = `greeting-${greeting._id}`;
            
            const createdDate = greeting.created_at ? 
                new Date(greeting.created_at).toLocaleString('en-US', { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                }) : 'N/A';
            
            const escapedMessage = escapeHtml(greeting.message).replace(/'/g, "\\'");
            
            item.innerHTML = `
                <div class="greeting-content">
                    <div class="greeting-message">${escapeHtml(greeting.message)}</div>
                    <div class="greeting-meta">
                        <span class="badge">${greeting.language}</span>
                        <span style="margin-left: 10px;">Created: ${createdDate}</span>
                    </div>
                </div>
                <div class="greeting-actions">
                    <button class="btn-secondary" onclick="editGreeting('${greeting._id}', '${escapedMessage}', '${greeting.language}')">Update</button>
                    <button class="btn-danger" onclick="deleteGreeting('${greeting._id}')">Delete</button>
                </div>
            `;
            
            // Find the container after the h4
            const h4 = list.querySelector('h4');
            const container = h4 ? h4.nextElementSibling : list;
            
            if (container && container !== list) {
                container.insertBefore(item, container.firstChild);
            } else {
                // Create a container if it doesn't exist
                const wrapper = document.createElement('div');
                wrapper.appendChild(item);
                list.appendChild(wrapper);
            }
        }
        
        function updateGreetingInList(greeting) {
            const item = document.getElementById(`greeting-${greeting._id}`);
            if (!item) return;
            
            const messageDiv = item.querySelector('.greeting-message');
            const metaDiv = item.querySelector('.greeting-meta');
            const updateButton = item.querySelector('.btn-secondary');
            
            if (messageDiv) {
                messageDiv.textContent = greeting.message;
            }
            
            if (metaDiv) {
                const createdDate = greeting.created_at ? 
                    new Date(greeting.created_at).toLocaleString('en-US', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    }) : 'N/A';
                const updatedDate = greeting.updated_at ? 
                    new Date(greeting.updated_at).toLocaleString('en-US', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    }) : null;
                
                metaDiv.innerHTML = `
                    <span class="badge">${greeting.language}</span>
                    <span style="margin-left: 10px;">Created: ${createdDate}</span>
                    ${updatedDate ? `<span style="margin-left: 10px;">Updated: ${updatedDate}</span>` : ''}
                `;
            }
            
            // Update the edit button onclick with new message
            if (updateButton) {
                const escapedMessage = escapeHtml(greeting.message).replace(/'/g, "\\'");
                updateButton.setAttribute('onclick', `editGreeting('${greeting._id}', '${escapedMessage}', '${greeting.language}')`);
            }
        }
        
        function removeGreetingFromList(greetingId) {
            const item = document.getElementById(`greeting-${greetingId}`);
            if (item) {
                item.style.opacity = '0';
                item.style.transform = 'translateX(-20px)';
                setTimeout(() => item.remove(), 300);
            }
        }
        
        function updateMetricsFromWebSocket(data) {
            // Update health status
            if (data.health && data.health.status) {
                const healthCards = document.querySelectorAll('.stat-card');
                healthCards.forEach(card => {
                    const h3 = card.querySelector('h3');
                    if (h3 && h3.textContent.trim() === 'Health') {
                        const valueDiv = card.querySelector('.value');
                        if (valueDiv) {
                            const currentStatus = valueDiv.textContent.trim();
                            if (currentStatus !== data.health.status.toUpperCase()) {
                                valueDiv.style.transform = 'scale(1.1)';
                                setTimeout(() => {
                                    valueDiv.textContent = data.health.status.toUpperCase();
                                    valueDiv.style.color = data.health.status === 'healthy' ? 'var(--mongodb-green)' : 
                                                           data.health.status === 'unhealthy' ? '#f44336' : '#ff9800';
                                    valueDiv.style.transform = 'scale(1)';
                                }, 150);
                            }
                        }
                    }
                });
            }
            
            // Update database stats
            if (data.db_stats) {
                if (data.db_stats.objects !== undefined) {
                    updateStatCard('Documents', data.db_stats.objects);
                }
                if (data.db_stats.collections !== undefined) {
                    updateStatCard('Collections', data.db_stats.collections);
                }
                if (data.db_stats.indexes !== undefined) {
                    updateStatCard('Indexes', data.db_stats.indexes);
                }
            }
        }
        
        function updateStatCard(label, value) {
            const cards = document.querySelectorAll('.stat-card');
            cards.forEach(card => {
                const h3 = card.querySelector('h3');
                if (h3 && h3.textContent.trim() === label) {
                    const valueDiv = card.querySelector('.value');
                    if (valueDiv) {
                        const currentValue = valueDiv.textContent.trim();
                        const newValue = typeof value === 'string' ? value : String(value);
                        if (currentValue !== newValue) {
                            card.classList.add('updating');
                            valueDiv.style.transform = 'scale(1.1)';
                            setTimeout(() => {
                                valueDiv.textContent = newValue;
                                valueDiv.style.transform = 'scale(1)';
                                card.classList.remove('updating');
                            }, 150);
                        }
                    }
                }
            });
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        async function getTotalGreetingsCount() {
            try {
                const response = await fetch('/api/metrics');
                const data = await response.json();
                if (data.collections && data.collections.greetings) {
                    return data.collections.greetings.count || 0;
                }
                // Fallback: count items in DOM
                return document.querySelectorAll('.greeting-item').length;
            } catch (err) {
                // Fallback: count items in DOM
                return document.querySelectorAll('.greeting-item').length;
            }
        }
        
        // Periodic connection health check - FORCE update based on actual state
        setInterval(() => {
            if (ws) {
                const state = ws.readyState;
                if (state === WebSocket.OPEN) {
                    // Connection is definitely open - FORCE status to connected
                    updateConnectionStatus(true);
                } else if (state === WebSocket.CLOSED || state === WebSocket.CLOSING) {
                    // Connection is closed, update status
                    updateConnectionStatus(false);
                    // Try to reconnect if not already attempting
                    if (!reconnectTimeout && reconnectAttempts < maxReconnectAttempts && state === WebSocket.CLOSED) {
                        attemptReconnect();
                    }
                }
            }
        }, 1000); // Check every 1 second - more aggressive
        
        // WebSocket demo functions with loading states
        function setButtonLoading(buttonId, loading) {
            const btn = document.getElementById(buttonId);
            if (btn) {
                if (loading) {
                    btn.classList.add('loading');
                    btn.disabled = true;
                } else {
                    btn.classList.remove('loading');
                    btn.disabled = false;
                }
            }
        }
        
        function sendEchoTest() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                const message = prompt('Enter a message to echo:', 'Hello from client!');
                if (message) {
                    setButtonLoading('btn-echo', true);
                    ws.send(JSON.stringify({
                        type: 'echo_test',
                        message: message
                    }));
                    addResponse('info', 'Sent', `Echo test: "${message}"`, new Date().toISOString());
                    setTimeout(() => setButtonLoading('btn-echo', false), 500);
                }
            } else {
                showConnectionError();
            }
        }
        
        function requestServerTime() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                setButtonLoading('btn-time', true);
                ws.send(JSON.stringify({
                    type: 'request_server_time'
                }));
                addResponse('info', 'Sent', 'Requested server time...', new Date().toISOString());
                setTimeout(() => setButtonLoading('btn-time', false), 500);
            } else {
                showConnectionError();
            }
        }
        
        function incrementCounter() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                setButtonLoading('btn-increment', true);
                ws.send(JSON.stringify({
                    type: 'increment_counter'
                }));
                addResponse('info', 'Sent', 'Incrementing counter...', new Date().toISOString());
                setTimeout(() => setButtonLoading('btn-increment', false), 500);
            } else {
                showConnectionError();
            }
        }
        
        function resetCounter() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                if (confirm('Reset the global counter to 0?')) {
                    setButtonLoading('btn-reset', true);
                    ws.send(JSON.stringify({
                        type: 'reset_counter'
                    }));
                    addResponse('info', 'Sent', 'Resetting counter...', new Date().toISOString());
                    setTimeout(() => setButtonLoading('btn-reset', false), 500);
                }
            } else {
                showConnectionError();
            }
        }
        
        function requestGreetingsCount() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                setButtonLoading('btn-count', true);
                ws.send(JSON.stringify({
                    type: 'request_greetings_count'
                }));
                addResponse('info', 'Sent', 'Requesting greetings count...', new Date().toISOString());
                setTimeout(() => setButtonLoading('btn-count', false), 500);
            } else {
                showConnectionError();
            }
        }
        
        function sendCustomPing() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                setButtonLoading('btn-ping', true);
                ws.send(JSON.stringify({
                    type: 'ping',
                    timestamp: new Date().toISOString()
                }));
                addResponse('info', 'Sent', 'Sent custom ping to server...', new Date().toISOString());
                setTimeout(() => setButtonLoading('btn-ping', false), 500);
            } else {
                showConnectionError();
            }
        }
        
        function showConnectionError() {
            addResponse('error', 'Error', 'WebSocket not connected. Please wait for connection.', new Date().toISOString());
        }
        
        function addResponse(type, title, message, timestamp) {
            const container = document.getElementById('websocket-responses');
            if (!container) return;
            
            // Remove placeholder if it exists
            const placeholder = container.querySelector('.response-placeholder');
            if (placeholder) {
                placeholder.style.animation = 'fadeOut 0.2s ease-out';
                setTimeout(() => placeholder.remove(), 200);
            }
            
            const responseItem = document.createElement('div');
            responseItem.className = `response-item ${type}`;
            responseItem.style.opacity = '0';
            responseItem.style.transform = 'translateX(-8px)';
            responseItem.innerHTML = `
                <div class="response-item-content">
                    <div class="response-type">${title}</div>
                    <div class="response-message">${message}</div>
                </div>
                <div class="response-time">${new Date(timestamp).toLocaleTimeString()}</div>
            `;
            
            container.insertBefore(responseItem, container.firstChild);
            
            // Animate in
            requestAnimationFrame(() => {
                responseItem.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                responseItem.style.opacity = '1';
                responseItem.style.transform = 'translateX(0)';
            });
            
            // Keep only last 15 responses
            while (container.children.length > 15) {
                const lastChild = container.lastChild;
                lastChild.style.transition = 'all 0.2s ease-out';
                lastChild.style.opacity = '0';
                lastChild.style.transform = 'translateX(8px)';
                setTimeout(() => lastChild.remove(), 200);
            }
        }
        
        function updateLiveCounter(value) {
            const counterEl = document.getElementById('live-counter');
            if (counterEl) {
                const oldValue = parseInt(counterEl.textContent) || 0;
                const newValue = parseInt(value) || 0;
                
                // Animate number change
                if (oldValue !== newValue) {
                    counterEl.style.transition = 'none';
                    counterEl.style.transform = 'scale(0.8)';
                    counterEl.style.opacity = '0.5';
                    
                    requestAnimationFrame(() => {
                        counterEl.textContent = newValue;
                        counterEl.style.transition = 'all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
                        counterEl.classList.add('updated');
                        counterEl.style.transform = 'scale(1)';
                        counterEl.style.opacity = '1';
                        
                        setTimeout(() => {
                            counterEl.classList.remove('updated');
                        }, 600);
                    });
                }
            }
        }
        
        function updateWebSocketStatus(connected) {
            const badge = document.getElementById('ws-status-badge');
            const text = document.getElementById('ws-status-text');
            if (badge && text) {
                if (connected) {
                    badge.classList.add('connected');
                    text.textContent = 'Connected';
                } else {
                    badge.classList.remove('connected');
                    text.textContent = 'Disconnected';
                }
            }
        }
        
        // Connect WebSocket when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', connectWebSocket);
        } else {
            connectWebSocket();
        }
        
        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (ws) {
                ws.close(1000, 'Page unloading'); // Normal closure
            }
            if (reconnectTimeout) {
                clearTimeout(reconnectTimeout);
            }
        });
    </script>
</body>
</html>
